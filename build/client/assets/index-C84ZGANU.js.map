{"version":3,"file":"index-C84ZGANU.js","sources":["../../../app/routes/user+/index.tsx"],"sourcesContent":["import { invariantResponse } from '@epic-web/invariant'\nimport { json, LoaderFunction, type LoaderFunctionArgs } from '@remix-run/node'\nimport { Form, Link, useLoaderData, type MetaFunction } from '@remix-run/react'\nimport { GeneralErrorBoundary } from '#app/components/error-boundary.tsx'\nimport { Spacer } from '#app/components/spacer.tsx'\nimport { Button } from '#app/components/ui/button.tsx'\nimport { Icon } from '#app/components/ui/icon.tsx'\nimport { prisma } from '#app/utils/db.server.ts'\nimport { getUserImgSrc } from '#app/utils/misc.tsx'\nimport { useOptionalUser } from '#app/utils/user.ts'\nimport { sessionKey } from '#app/utils/auth.server.ts'\nimport { authSessionStorage } from '#app/utils/session.server.ts'\n\nimport { redirect } from '@remix-run/node'\n\n//API Call\n// @ts-ignore\nimport { userAPI } from '../../api/userAPI';\n\n// Define the User type\ninterface User {\n\t_id: string;\n\tname: string;\n\tusername: string;\n\temail: string;\n\tbalance: number;\n\thistory: [{\n\t\ttype: string;\n\t\tprice: number;\n\t\tbusinessName: string;\n\t}];\n\tinvestments: [{\n\t\tisActive: boolean;\n\t}];\n\tcreatedAt: Date;\n}\n\nexport const loader: LoaderFunction = async ({ params, request }) => {\n\n\t//Get Token\n\t//See if we are logged in by checking the session\n\tconst authSession = await authSessionStorage.getSession(\n\t\trequest.headers.get('cookie'),\n\t)\n  \tconst session = authSession.get(sessionKey);\n\n\tif (session) {\n\t\t//Get User\n\t\tconst user = await userAPI.checklogintoken(session);\n\n\t\tif (user) {\n\t\t\treturn json({ user, userJoinedDisplay: new Date(user.createdAt).toLocaleDateString() })\n\t\t}\n\t\telse {\n\t\t\treturn redirect('/');\n\t\t}\n\t}\n\telse {\n\t\treturn redirect('/');\n\t}\n}\n\nexport default function ProfileRoute() {\n\t//const data = useLoaderData<typeof loader>()\n\t//const user = data.user\n\tconst { user, userJoinedDisplay }  = useLoaderData<{ user: User, userJoinedDisplay: Date}>();\n\n\tconst loggedInUser = useOptionalUser()\n\tconst isLoggedInUser = user._id === loggedInUser?._id\n\n\treturn (\n\t\t<div className=\"container mb-48 mt-36 flex flex-col items-center justify-center\">\n\t\t\t<Spacer size=\"4xs\" />\n\n\t\t\t<div className=\"container flex flex-col items-center rounded-3xl bg-muted p-12\">\n\n\t\t\t\t<Spacer size=\"sm\" />\n\n\t\t\t\t<div className=\"flex flex-col items-center\">\n\t\t\t\t\t<div className=\"flex flex-wrap items-center justify-center gap-4\">\n\t\t\t\t\t\t<h1 className=\"text-center text-h2\">{user.name}</h1>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p className=\"mt-2 text-center text-muted-foreground\">\n\t\t\t\t\t\tJoined: {userJoinedDisplay}\n\t\t\t\t\t</p>\n\t\t\t\t\t<div className=\"bg-white shadow-md rounded-lg p-6 w-full max-w-md mt-5\">\n\t\t\t\t\t\t<h2 className=\"text-2xl text-center font-bold mb-4\">User Statistics</h2>\n\t\t\t\t\t\t<div className=\"flex flex-row justify-between gap-4\">\n\t\t\t\t\t\t\t<div className=\"flex flex-col justify-between\">\n\t\t\t\t\t\t\t\t<span className=\"text-center text-lg\">{user.history.length}</span> \n\t\t\t\t\t\t\t\t<span className=\"text-sm\"> Trades Lifetime</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"flex flex-col justify-between\">\n\t\t\t\t\t\t\t\t<span className=\"text-center text-lg\">{user.investments.length}</span>\n\t\t\t\t\t\t\t\t<span className=\"text-sm\"> Investments Lifetime</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{isLoggedInUser ? (\n\t\t\t\t\t\t<Form action=\"/logout\" method=\"POST\" className=\"mt-3\">\n\t\t\t\t\t\t\t<Button type=\"submit\" variant=\"link\" size=\"pill\">\n\t\t\t\t\t\t\t\t<Icon name=\"exit\" className=\"scale-125 max-md:scale-150\">\n\t\t\t\t\t\t\t\t\tLogout\n\t\t\t\t\t\t\t\t</Icon>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</Form>\n\t\t\t\t\t) : null}\n\t\t\t\t\t<div className=\"mt-10 flex gap-4\">\n\t\t\t\t\t\t\t<Button asChild>\n\t\t\t\t\t\t\t\t<Link to=\"/dashboard\" prefetch=\"intent\">\n\t\t\t\t\t\t\t\t\tDashboard\n\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t</Button>\t\n\t\t\t\t\t\t\t<Button asChild>\n\t\t\t\t\t\t\t\t<Link \n\t\t\t\t\t\t\t\t\tto={{\n\t\t\t\t\t\t\t\t\t\tpathname: \"/settings/profile\",\n\t\t\t\t\t\t\t\t\t\tsearch: `?id=${user._id}&username=${user.username}&name=${user.name}&email=${user.email}`,\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tprefetch=\"intent\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tEdit profile\n\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n\nexport function ErrorBoundary() {\n\treturn (\n\t\t<GeneralErrorBoundary\n\t\t\tstatusHandlers={{\n\t\t\t\t404: ({ params }) => (\n\t\t\t\t\t<p>No user with the username \"{params.username}\" exists</p>\n\t\t\t\t),\n\t\t\t}}\n\t\t/>\n\t)\n}\n"],"names":["ProfileRoute","user","userJoinedDisplay","useLoaderData","loggedInUser","useOptionalUser","isLoggedInUser","_id","jsxs","className","children","jsx","Spacer","size","name","history","length","investments","Form","action","method","Button","type","variant","Icon","asChild","Link","to","prefetch","pathname","search","username","email","ErrorBoundary","GeneralErrorBoundary","statusHandlers","params"],"mappings":"keA8DA,SAAwBA,GAAe,CAGtC,KAAM,CAAEC,KAAAA,EAAMC,kBAAAA,CAAkB,EAAKC,EAAsD,EAErFC,EAAeC,IACfC,EAAiBL,EAAKM,OAAQH,GAAAA,YAAAA,EAAcG,KAGjD,OAAAC,EAAAA,KAAC,MAAI,CAAAC,UAAU,kEACdC,SAAA,CAACC,EAAA,IAAAC,EAAA,CAAOC,KAAK,KAAM,CAAA,EAEnBL,EAAA,KAAC,MAAI,CAAAC,UAAU,iEAEdC,SAAA,CAACC,EAAA,IAAAC,EAAA,CAAOC,KAAK,IAAK,CAAA,EAElBL,EAAA,KAAC,MAAI,CAAAC,UAAU,6BACdC,SAAA,CAACC,EAAA,IAAA,MAAA,CAAIF,UAAU,mDACdC,SAAAC,EAAA,IAAC,MAAGF,UAAU,sBAAuBC,SAAKT,EAAAa,KAAK,CAChD,CAAA,EACAN,EAAA,KAAC,IAAE,CAAAC,UAAU,yCAAyCC,SAAA,CAAA,WAC5CR,CAAA,CACV,CAAA,EACAM,EAAA,KAAC,MAAI,CAAAC,UAAU,yDACdC,SAAA,CAACC,EAAA,IAAA,KAAA,CAAGF,UAAU,sCAAsCC,SAAe,iBAAA,CAAA,EACnEF,EAAA,KAAC,MAAI,CAAAC,UAAU,sCACdC,SAAA,CAACF,EAAA,KAAA,MAAA,CAAIC,UAAU,gCACdC,SAAA,CAAAC,EAAA,IAAC,OAAK,CAAAF,UAAU,sBAAuBC,SAAAT,EAAKc,QAAQC,MAAO,CAAA,EAC1DL,EAAA,IAAA,OAAA,CAAKF,UAAU,UAAUC,SAAgB,kBAAA,CAAA,CAAA,CAC3C,CAAA,EACAF,EAAA,KAAC,MAAI,CAAAC,UAAU,gCACdC,SAAA,CAAAC,EAAA,IAAC,OAAK,CAAAF,UAAU,sBAAuBC,SAAAT,EAAKgB,YAAYD,MAAO,CAAA,EAC9DL,EAAA,IAAA,OAAA,CAAKF,UAAU,UAAUC,SAAqB,uBAAA,CAAA,CAAA,CAChD,CAAA,CAAA,CACD,CAAA,CAAA,EACD,EACCJ,EACCK,EAAA,IAAAO,EAAA,CAAKC,OAAO,UAAUC,OAAO,OAAOX,UAAU,OAC9CC,SAACC,EAAA,IAAAU,EAAA,CAAOC,KAAK,SAASC,QAAQ,OAAOV,KAAK,OACzCH,SAAAC,EAAA,IAACa,EAAK,CAAAV,KAAK,OAAOL,UAAU,6BAA6BC,SAAA,SAEzD,EACD,EACD,EACG,KACJF,EAAA,KAAC,MAAI,CAAAC,UAAU,mBACbC,SAAA,CAACC,EAAA,IAAAU,EAAA,CAAOI,QAAO,GACdf,SAACC,EAAA,IAAAe,EAAA,CAAKC,GAAG,aAAaC,SAAS,SAASlB,SAAA,YAExC,CACD,CAAA,EACAC,EAAA,IAACU,EAAO,CAAAI,QAAO,GACdf,SAAAC,EAAA,IAACe,EAAA,CACAC,GAAI,CACHE,SAAU,oBACVC,OAAQ,OAAO7B,EAAKM,GAAG,aAAaN,EAAK8B,QAAQ,SAAS9B,EAAKa,IAAI,UAAUb,EAAK+B,KAAK,EACxF,EACAJ,SAAS,SACTlB,SAAA,eAED,CACD,CAAA,CAAA,CACF,CAAA,CAAA,CACD,CAAA,CAAA,CACD,CAAA,CAAA,CACD,CAAA,CAEF,CAEO,SAASuB,GAAgB,CAE9B,OAAAtB,EAAAA,IAACuB,EAAA,CACAC,eAAgB,CACf,IAAK,CAAC,CAAEC,OAAAA,CAAO,WACb,IAAE,CAAA1B,SAAA,CAAA,8BAA4B0B,EAAOL,SAAS,UAAA,EAAQ,CAEzD,CAAA,CACD,CAEF"}