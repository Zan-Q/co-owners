import{j as e,r as g}from"./jsx-runtime-D2HyDbKh.js";import{z as i}from"./index-BeXw7Xwl.js";import{f as N}from"./floating-toolbar-B1U7BWws.js";import{u as y,b as F,g as I,F as T,a as x,T as P,c as b,L as v,E as d,d as w,e as L}from"./forms-pZ2rD6vG.js";import{B as f}from"./button-BTFmWHin.js";import{I as p}from"./icon-CldSu2rP.js";import{S}from"./status-button-jM1d2HtI.js";import{u as B,b as A,c as E}from"./misc-D_OAexT3.js";import{a as R,F as C}from"./components-7CkHrf4S.js";import{g as M}from"./constraint-Bik5U1QS.js";import{p as V}from"./parse-C-ev3aC7.js";import"./submission-BBd9SSur.js";import"./index-tx3aR2qd.js";import"./index-4Ns2fbOC.js";import"./index-PxjvPj8E.js";import"./tooltip-DXoIDLmn.js";import"./clsx-B-dksMZM.js";import"./index-Cd_vq22D.js";const z=1,Z=100,D=1,O=1e4,U=1024*1024*3,_=i.object({id:i.string().optional(),file:i.instanceof(File).optional().refine(t=>!t||t.size<=U,"File size must be less than 3MB"),altText:i.string().optional()}),j=i.object({id:i.string().optional(),title:i.string().min(z).max(Z),content:i.string().min(D).max(O),images:i.array(_).max(5).optional()});function le({note:t}){const s=R(),o=B(),[r,a]=y({id:"note-editor",constraint:M(j),lastResult:s==null?void 0:s.result,onValidate({formData:n}){return V(n,{schema:j})},defaultValue:{...t,images:(t==null?void 0:t.images)??[{}]},shouldRevalidate:"onBlur"}),c=a.images.getFieldList();return e.jsx("div",{className:"absolute inset-0",children:e.jsxs(F,{context:r.context,children:[e.jsxs(C,{method:"POST",className:"flex h-full flex-col gap-y-4 overflow-y-auto overflow-x-hidden px-10 pb-28 pt-12",...I(r),encType:"multipart/form-data",children:[e.jsx("button",{type:"submit",className:"hidden"}),t?e.jsx("input",{type:"hidden",name:"id",value:t.id}):null,e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(T,{labelProps:{children:"Title"},inputProps:{autoFocus:!0,...x(a.title,{type:"text"})},errors:a.title.errors}),e.jsx(P,{labelProps:{children:"Content"},textareaProps:{...b(a.content)},errors:a.content.errors}),e.jsxs("div",{children:[e.jsx(v,{children:"Images"}),e.jsx("ul",{className:"flex flex-col gap-4",children:c.map((n,l)=>e.jsxs("li",{className:"relative border-b-2 border-muted-foreground",children:[e.jsxs("button",{className:"absolute right-0 top-0 text-foreground-destructive",...r.remove.getButtonProps({name:a.images.name,index:l}),children:[e.jsx("span",{"aria-hidden":!0,children:e.jsx(p,{name:"cross-1"})})," ",e.jsxs("span",{className:"sr-only",children:["Remove image ",l+1]})]}),e.jsx(k,{meta:n})]},n.key))})]}),e.jsxs(f,{className:"mt-3",...r.insert.getButtonProps({name:a.images.name}),children:[e.jsx("span",{"aria-hidden":!0,children:e.jsx(p,{name:"plus",children:"Image"})})," ",e.jsx("span",{className:"sr-only",children:"Add image"})]})]}),e.jsx(d,{id:r.errorId,errors:r.errors})]}),e.jsxs("div",{className:N,children:[e.jsx(f,{variant:"destructive",...r.reset.getButtonProps(),children:"Reset"}),e.jsx(S,{form:r.id,type:"submit",disabled:o,status:o?"pending":"idle",children:"Submit"})]})]})})}function k({meta:t}){const s=t.getFieldset(),o=!!s.id.initialValue,[r,a]=g.useState(s.id.initialValue?A(s.id.initialValue):null),[c,n]=g.useState(s.altText.initialValue??"");return e.jsxs("fieldset",{...w(t),children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"w-32",children:[e.jsx("div",{className:"relative h-32 w-32",children:e.jsxs("label",{htmlFor:s.file.id,className:E("group absolute h-32 w-32 rounded-lg",{"bg-accent opacity-40 focus-within:opacity-100 hover:opacity-100":!r,"cursor-pointer focus-within:ring-2":!o}),children:[r?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r,alt:c??"",className:"h-32 w-32 rounded-lg object-cover"}),o?null:e.jsx("div",{className:"pointer-events-none absolute -right-0.5 -top-0.5 rotate-12 rounded-sm bg-secondary px-2 py-1 text-xs text-secondary-foreground shadow-md",children:"new"})]}):e.jsx("div",{className:"flex h-32 w-32 items-center justify-center rounded-lg border border-muted-foreground text-4xl text-muted-foreground",children:e.jsx(p,{name:"plus"})}),o?e.jsx("input",{...x(s.id,{type:"hidden"})}):null,e.jsx("input",{"aria-label":"Image",className:"absolute left-0 top-0 z-0 h-32 w-32 cursor-pointer opacity-0",onChange:l=>{var h;const u=(h=l.target.files)==null?void 0:h[0];if(u){const m=new FileReader;m.onloadend=()=>{a(m.result)},m.readAsDataURL(u)}else a(null)},accept:"image/*",...x(s.file,{type:"file"})})]})}),e.jsx("div",{className:"min-h-[32px] px-4 pb-3 pt-1",children:e.jsx(d,{id:s.file.errorId,errors:s.file.errors})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(v,{htmlFor:s.altText.id,children:"Alt Text"}),e.jsx(L,{onChange:l=>n(l.currentTarget.value),...b(s.altText)}),e.jsx("div",{className:"min-h-[32px] px-4 pb-3 pt-1",children:e.jsx(d,{id:s.altText.errorId,errors:s.altText.errors})})]})]}),e.jsx("div",{className:"min-h-[32px] px-4 pb-3 pt-1",children:e.jsx(d,{id:t.errorId,errors:t.errors})})]})}export{le as default};
//# sourceMappingURL=notes.new-Dgvq8P0o.js.map
